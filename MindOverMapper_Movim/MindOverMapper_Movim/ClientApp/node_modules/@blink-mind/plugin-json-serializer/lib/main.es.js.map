{"version":3,"file":"main.es.js","sources":["../src/plguins/index.ts"],"sourcesContent":["import { Block, Config, Model, Topic } from '@blink-mind/core';\nimport { List, Map } from 'immutable';\nimport debug from 'debug';\n\nconst log = debug('plugin:json-serializer');\n\nexport function JsonSerializerPlugin() {\n  return {\n    serializeModel(props) {\n      const { model, controller } = props;\n      const obj = {\n        rootTopicKey: model.rootTopicKey,\n        topics: model.topics\n          .valueSeq()\n          .toArray()\n          .map(topic => controller.run('serializeTopic', { ...props, topic })),\n        config: controller.run('serializeConfig', {\n          ...props,\n          config: model.config\n        })\n      };\n      return obj;\n    },\n\n    deserializeModel(props) {\n      const { obj, controller } = props;\n      const { rootTopicKey, topics, config } = obj;\n      let model = new Model();\n      model = model.merge({\n        rootTopicKey,\n        editorRootTopicKey: rootTopicKey,\n        config: controller.run('deserializeConfig', {\n          ...props,\n          obj: config\n        }),\n        topics: controller.run('deserializeTopics', {\n          ...props,\n          obj: topics\n        })\n      });\n      log('deserializeModel', model);\n      return model;\n    },\n\n    serializeConfig(props) {\n      const { config } = props;\n      return config.toJS();\n    },\n\n    deserializeConfig(props) {\n      const { obj } = props;\n      return new Config(obj);\n    },\n\n    serializeTopic(props) {\n      const { topic, controller } = props;\n      return {\n        key: topic.key,\n        parentKey: topic.parentKey,\n        subKeys: topic.subKeys.toArray(),\n        collapse: topic.collapse,\n        style: topic.style,\n        blocks: topic.blocks.map(block =>\n          controller.run('serializeBlock', { ...props, block })\n        )\n      };\n    },\n\n    deserializeTopic(props) {\n      const { obj, controller } = props;\n      const { key, parentKey, subKeys, blocks, style, collapse } = obj;\n      let topic = new Topic();\n      topic = topic.merge({\n        key,\n        parentKey,\n        subKeys: List(subKeys),\n        style,\n        collapse,\n        blocks: controller.run('deserializeBlocks', { ...props, obj: blocks })\n      });\n      return topic;\n    },\n\n    deserializeTopics(props) {\n      const { obj, controller } = props;\n      let topics = Map();\n      topics = topics.withMutations(topics => {\n        obj.forEach(topic =>\n          topics.set(\n            topic.key,\n            controller.run('deserializeTopic', { ...props, obj: topic })\n          )\n        );\n      });\n      return topics;\n    },\n\n    serializeBlock(props) {\n      const { block } = props;\n      return block.toJS();\n    },\n\n    deserializeBlock(props) {\n      const { obj } = props;\n      return new Block(obj);\n    },\n\n    deserializeBlocks(props) {\n      const { obj, controller } = props;\n      let blocks = List();\n      blocks = blocks.withMutations(blocks => {\n        obj.forEach(block =>\n          blocks.push(\n            controller.run('deserializeBlock', { ...props, obj: block })\n          )\n        );\n      });\n      return blocks;\n    }\n  };\n}\n"],"names":[],"mappings":"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"}