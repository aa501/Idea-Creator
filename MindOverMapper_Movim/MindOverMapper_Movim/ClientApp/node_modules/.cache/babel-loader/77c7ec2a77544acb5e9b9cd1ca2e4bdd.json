{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _dec, _desc, _value, _class;\n\nvar _react = require(\"react\");\n\nvar React = _interopRequireWildcard(_react);\n\nvar _reactDom = require(\"react-dom\");\n\nvar _reactKeydown = require(\"react-keydown\");\n\nvar _reactKeydown2 = _interopRequireDefault(_reactKeydown);\n\nvar _styledComponents = require(\"styled-components\");\n\nvar _styledComponents2 = _interopRequireDefault(_styledComponents);\n\nvar _outlineIcons = require(\"outline-icons\");\n\nvar _getDataTransferFiles = require(\"../../lib/getDataTransferFiles\");\n\nvar _getDataTransferFiles2 = _interopRequireDefault(_getDataTransferFiles);\n\nvar _EditList = require(\"../../plugins/EditList\");\n\nvar _EditList2 = _interopRequireDefault(_EditList);\n\nvar _ToolbarButton = require(\"./ToolbarButton\");\n\nvar _ToolbarButton2 = _interopRequireDefault(_ToolbarButton);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var gen = fn.apply(this, arguments);\n    return new Promise(function (resolve, reject) {\n      function step(key, arg) {\n        try {\n          var info = gen[key](arg);\n          var value = info.value;\n        } catch (error) {\n          reject(error);\n          return;\n        }\n\n        if (info.done) {\n          resolve(value);\n        } else {\n          return Promise.resolve(value).then(function (value) {\n            step(\"next\", value);\n          }, function (err) {\n            step(\"throw\", err);\n          });\n        }\n      }\n\n      return step(\"next\");\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object['ke' + 'ys'](descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object['define' + 'Property'](target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nvar changes = _EditList2.default.changes;\nvar BlockToolbar = (_dec = (0, _reactKeydown2.default)(\"esc\"), (_class = function (_React$Component) {\n  _inherits(BlockToolbar, _React$Component);\n\n  function BlockToolbar() {\n    var _ref,\n        _this2 = this;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, BlockToolbar);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = BlockToolbar.__proto__ || Object.getPrototypeOf(BlockToolbar)).call.apply(_ref, [this].concat(args))), _this), _this.handleOutsideMouseClick = function (ev) {\n      var element = (0, _reactDom.findDOMNode)(_this.bar);\n\n      if (!element || ev.target instanceof Node && element.contains(ev.target) || ev.button && ev.button !== 0) {\n        return;\n      }\n\n      _this.removeSelf(ev);\n    }, _this.insertBlock = function (options) {\n      var cursorPosition = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"on\";\n      var editor = _this.props.editor;\n      editor.moveToEndOfNode(_this.props.node);\n\n      if (options.type === \"table\") {\n        editor.insertTable(3, 3);\n      } else {\n        editor.insertBlock(options.type);\n      }\n\n      editor.removeNodeByKey(_this.props.node.key).moveToEnd();\n      if (cursorPosition === \"before\") editor.moveToStartOfPreviousBlock();\n      if (cursorPosition === \"after\") editor.moveToStartOfNextBlock();\n      return editor.focus();\n    }, _this.insertList = function (type) {\n      var editor = _this.props.editor;\n      var checked = type === \"todo-list\" ? false : undefined;\n      editor.moveToEndOfNode(_this.props.node).command(changes.wrapInList, type, undefined, {\n        type: \"list-item\",\n        data: {\n          checked: checked\n        }\n      });\n      return editor.removeNodeByKey(_this.props.node.key).moveToEndOfNextBlock().focus();\n    }, _this.handleClickBlock = function (ev, type) {\n      ev.preventDefault();\n      ev.stopPropagation();\n\n      switch (type) {\n        case \"heading1\":\n        case \"heading2\":\n        case \"block-quote\":\n        case \"table\":\n        case \"code\":\n          return _this.insertBlock({\n            type: type\n          });\n\n        case \"horizontal-rule\":\n          return _this.insertBlock({\n            type: {\n              type: \"horizontal-rule\",\n              isVoid: true\n            }\n          }, \"after\");\n\n        case \"bulleted-list\":\n          return _this.insertList(\"bulleted-list\");\n\n        case \"ordered-list\":\n          return _this.insertList(\"ordered-list\");\n\n        case \"todo-list\":\n          return _this.insertList(\"todo-list\");\n\n        case \"image\":\n          return _this.onPickImage();\n\n        default:\n      }\n    }, _this.onPickImage = function () {\n      // simulate a click on the file upload input element\n      if (_this.file) _this.file.click();\n    }, _this.onImagePicked = function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee(ev) {\n        var files, editor, i, file;\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                files = (0, _getDataTransferFiles2.default)(ev);\n                editor = _this.props.editor;\n\n                for (i = 0; i < files.length; i++) {\n                  file = files[i];\n                  editor.insertImageFile(file);\n                }\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, _this2);\n      }));\n\n      return function (_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }(), _this.renderBlockButton = function (type, IconClass, tooltip) {\n      var hiddenToolbarButtons = _this.props.theme.hiddenToolbarButtons;\n      var Tooltip = _this.props.editor.props.tooltip;\n\n      if (hiddenToolbarButtons && hiddenToolbarButtons.blocks && hiddenToolbarButtons.blocks.includes(type)) {\n        return null;\n      }\n\n      return React.createElement(_ToolbarButton2.default, {\n        onMouseDown: function onMouseDown(ev) {\n          return _this.handleClickBlock(ev, type);\n        }\n      }, React.createElement(Tooltip, {\n        tooltip: tooltip,\n        placement: \"top\"\n      }, React.createElement(IconClass, {\n        color: _this.props.theme.blockToolbarItem\n      })));\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(BlockToolbar, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (typeof window !== \"undefined\") {\n        window.addEventListener(\"click\", this.handleOutsideMouseClick);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (typeof window !== \"undefined\") {\n        window.removeEventListener(\"click\", this.handleOutsideMouseClick);\n      }\n    }\n  }, {\n    key: \"removeSelf\",\n    value: function removeSelf(ev) {\n      ev.preventDefault();\n      ev.stopPropagation();\n      this.props.editor.setNodeByKey(this.props.node.key, {\n        type: \"paragraph\",\n        text: \"\",\n        isVoid: false\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _props = this.props,\n          editor = _props.editor,\n          attributes = _props.attributes;\n      var hasImageUpload = !!editor.props.uploadImage;\n      return React.createElement(Bar, _extends({}, attributes, {\n        ref: function ref(_ref4) {\n          return _this3.bar = _ref4;\n        }\n      }), React.createElement(HiddenInput, {\n        type: \"file\",\n        ref: function ref(_ref3) {\n          return _this3.file = _ref3;\n        },\n        onChange: this.onImagePicked,\n        accept: \"image/*\"\n      }), this.renderBlockButton(\"heading1\", _outlineIcons.Heading1Icon, \"Add heading\"), this.renderBlockButton(\"heading2\", _outlineIcons.Heading2Icon, \"Add subheading\"), React.createElement(Separator, null), this.renderBlockButton(\"bulleted-list\", _outlineIcons.BulletedListIcon, \"Start bulleted list\"), this.renderBlockButton(\"ordered-list\", _outlineIcons.OrderedListIcon, \"Start numbered List\"), this.renderBlockButton(\"todo-list\", _outlineIcons.TodoListIcon, \"Start checklist\"), React.createElement(Separator, null), this.renderBlockButton(\"table\", _outlineIcons.TableIcon, \"Create table\"), this.renderBlockButton(\"block-quote\", _outlineIcons.BlockQuoteIcon, \"Add quote\"), this.renderBlockButton(\"code\", _outlineIcons.CodeIcon, \"Add code\"), this.renderBlockButton(\"horizontal-rule\", _outlineIcons.HorizontalRuleIcon, \"Add break\"), hasImageUpload && this.renderBlockButton(\"image\", _outlineIcons.ImageIcon, \"Add image\"));\n    }\n  }]);\n\n  return BlockToolbar;\n}(React.Component), _applyDecoratedDescriptor(_class.prototype, \"removeSelf\", [_dec], Object.getOwnPropertyDescriptor(_class.prototype, \"removeSelf\"), _class.prototype), _class));\n\nvar Separator = _styledComponents2.default.div.withConfig({\n  displayName: \"BlockToolbar__Separator\",\n  componentId: \"sc-1bzrnp2-0\"\n})([\"height:100%;width:1px;background:rgba(0,0,0,0.1);display:inline-block;margin-left:10px;\"]);\n\nvar Bar = _styledComponents2.default.div.withConfig({\n  displayName: \"BlockToolbar__Bar\",\n  componentId: \"sc-1bzrnp2-1\"\n})([\"display:flex;z-index:\", \";position:relative;align-items:center;background:\", \";height:44px;&:before,&:after{content:\\\"\\\";position:absolute;left:-100%;width:100%;height:44px;background:\", \";}&:after{left:auto;right:-100%;}@media print{display:none;}\"], function (props) {\n  return props.theme.zIndex;\n}, function (props) {\n  return props.theme.blockToolbarBackground;\n}, function (props) {\n  return props.theme.blockToolbarBackground;\n});\n\nvar HiddenInput = _styledComponents2.default.input.withConfig({\n  displayName: \"BlockToolbar__HiddenInput\",\n  componentId: \"sc-1bzrnp2-2\"\n})([\"position:absolute;top:-100px;left:-100px;visibility:hidden;\"]);\n\nexports.default = (0, _styledComponents.withTheme)(BlockToolbar);","map":null,"metadata":{},"sourceType":"script"}